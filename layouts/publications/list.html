{{ define "main" }}
<h1 style="text-align:center; margin-bottom:2rem;">ðŸ“š Publications</h1>

<!-- Barra di ricerca -->
<label>Filtra per anno, titolo o autore:
  <input type="text" id="searchInput" placeholder="Scrivi qui..." style="margin-left:0.5rem; padding:0.3rem; width:250px;">
</label>

<div id="listaPubblicazioni" style="margin-top:2rem;"></div>

<script>
// Crea array delle pubblicazioni
const pubs = [
{{- range .Pages -}}
  {{- $authors := .Params.authors | default (slice "Unknown") -}}
  {{- $types := .Params.publication_types | default (slice "") -}}
  {
    title: {{ .Title | jsonify }},
    authors: {{ $authors | jsonify }},
    year: {{ .Date.Format "2006" | jsonify }},
    type: {{ index $types 0 | default "" | jsonify }},
    url: {{ .RelPermalink | jsonify }}
  },
{{- end -}}
];
</script>

<script>
const searchInput = document.getElementById("searchInput");
const container = document.getElementById("listaPubblicazioni");

// Funzione per mostrare tutte le pubblicazioni filtrate
function filtraPubblicazioni() {
  const query = searchInput.value.toLowerCase().trim();

  container.innerHTML = "";

  pubs
    .filter(p => 
        !query || 
        p.year.includes(query) ||
        p.title.toLowerCase().includes(query) ||
        p.authors.join(" ").toLowerCase().includes(query)
    )
    .sort((a,b) => b.year - a.year) // decrescente per anno
    .forEach(p => {
      const div = document.createElement("div");
      div.className = "pub";
      div.innerHTML = `<strong>${p.title}</strong> â€” ${p.authors.join(", ")} (${p.year}) 
                       <a href="${p.url}">Vai</a>`;
      container.appendChild(div);
    });
}

// Mostra tutte le pubblicazioni allâ€™avvio
filtraPubblicazioni();

// Aggiorna in tempo reale al digitare
searchInput.addEventListener("input", filtraPubblicazioni);
</script>

<style>
.pub { margin-bottom: 1rem; padding:0.5rem; border-bottom:1px solid #eee; }
label { font-weight: bold; display:block; margin-bottom:1rem; }
input { border:1px solid #ccc; border-radius:4px; }
</style>
{{ end }}


