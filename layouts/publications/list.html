{{ define "main" }}
<h1 style="text-align:center; margin-bottom:2rem;">ðŸ“š Publications</h1>

<!-- Barra di ricerca -->
<label>Filtra per anno, titolo o autore:
  <input type="text" id="searchInput" placeholder="Scrivi qui..." style="margin-left:0.5rem; padding:0.3rem; width:250px;">
</label>

<div id="listaPubblicazioni" style="margin-top:2rem;"></div>

<!-- Genera array JS sicuro -->
<script>
const pubs = [
{{- $pubs := slice -}}
{{- range .Pages }}
  {{- $p := dict "title" .Title "authors" .Params.authors "year" (.Date.Format "2006") "type" (.Params.publication_types | first) "url" .RelPermalink -}}
  {{- $pubs = $pubs | append $p -}}
{{- end }}
{{ $pubs | jsonify }}
];
</script>

<script>
const searchInput = document.getElementById("searchInput");
const container = document.getElementById("listaPubblicazioni");

// Funzione di filtro
function filtraPubblicazioni() {
  const query = searchInput.value.toLowerCase().trim();

  container.innerHTML = "";

  pubs
    .filter(p => 
        !query || 
        p.year.includes(query) ||
        p.title.toLowerCase().includes(query) ||
        p.authors.join(" ").toLowerCase().includes(query)
    )
    .sort((a,b)=>b.year - a.year) // ordina decrescente per anno
    .forEach(p => {
      const div = document.createElement("div");
      div.className = "pub";
      div.innerHTML = `<strong>${p.title}</strong> â€” ${p.authors.join(", ")} (${p.year}) 
                       <a href="${p.url}">Vai</a>`;
      container.appendChild(div);
    });
}

// Inizializza e aggiorna in tempo reale
filtraPubblicazioni();
searchInput.addEventListener("input", filtraPubblicazioni);
</script>

<style>
.pub { margin-bottom: 1rem; padding:0.5rem; border-bottom:1px solid #eee; }
label { font-weight: bold; display:block; margin-bottom:1rem; }
input { border:1px solid #ccc; border-radius:4px; }
</style>
{{ end }}

